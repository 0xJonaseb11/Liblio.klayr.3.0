"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const YeomanGenerator = require("yeoman-generator");
const installActions = require("yeoman-generator/lib/actions/install");
const path_1 = require("path");
const assert = require("assert");
Object.assign(YeomanGenerator.prototype, installActions);
const DEFAULT_TEMPLATE_NAME = 'klayr-ts';
class BaseGenerator extends YeomanGenerator {
    constructor(args, opts) {
        var _a, _b;
        super(args, opts);
        if (opts.projectPath) {
            this.destinationRoot(opts.projectPath);
        }
        this._registry = opts.registry;
        this._klayrRC = this.createStorage('.klayrrc.json');
        this._klayrTemplateName = (_b = (_a = opts.template) !== null && _a !== void 0 ? _a : this._klayrRC.getPath('template')) !== null && _b !== void 0 ? _b : 'klayr-ts';
        this._commanderVersion = opts.version;
        if (this._klayrTemplateName === DEFAULT_TEMPLATE_NAME) {
            this._klayrTemplatePath = (0, path_1.join)((0, path_1.dirname)(__filename), '..', 'templates', 'klayr-template-ts');
        }
        else {
            this._klayrTemplatePath = require.resolve(this._klayrTemplateName);
        }
        this.log(`Using template "${this._klayrTemplateName}"`);
        this._klayrRC.setPath('commander.version', this._commanderVersion);
        this._klayrRC.setPath('template', this._klayrTemplateName);
        this.sourceRoot(this._klayrTemplatePath);
    }
    async _loadAndValidateTemplate() {
        this._klayrTemplate = (await Promise.resolve(`${this._klayrTemplatePath}`).then(s => require(s)));
        assert(this._klayrTemplate.generators, `Template "${this._klayrTemplateName}" does not have any generators`);
        assert(this._klayrTemplate.generators.init, `Template "${this._klayrTemplateName}" does not have "init" generators`);
    }
}
exports.default = BaseGenerator;
//# sourceMappingURL=base_generator.js.map